$(function(){
	$("#header .nav-top .mysp").mouseover(function(){
		$(".mysp span").css("background","url(img/top-ss.jpg) no-repeat")
		$(".mysp-li").css({"display":"block"})
		$(".mysp-li").mouseover(function(){
			$(".mysp-li").css({"display":"block"})
		})
		
	})
	$("#header .nav-top .nav-mysp").mouseout(function(){
		$(".mysp span").css("background","url(img/top-s.jpg) no-repeat")
		$(".mysp-li").css("display","none")
	})
	$("#header .nav-top .app").mouseover(function(){
		$(".app span").css("background","url(img/top-ss.jpg) no-repeat")
		$(".app-li").css("display","block")
		$(".app-li").mouseover(function(){
			$(".app-li").css({"display":"block"})
		})
	})
	$("#header .nav-top .my-app").mouseout(function(){
		$(".app span").css("background","url(img/top-s.jpg) no-repeat")
		$(".app-li").css("display","none")
		
	})
	$("#header .nav-top .cont").mouseover(function(){
		$(".cont span").css("background","url(img/top-ss.jpg) no-repeat")
		$(".cont-li").css("display","block")
		$(".cont-li").mouseover(function(){
			$(".cont-li").css({"display":"block"})
		})
	})
	$("#header .nav-top .my-cont").mouseout(function(){
		$(".cont span").css("background","url(img/top-s.jpg) no-repeat")
		$(".cont-li").css("display","none")
	})
	
	$(".login-f1 .a1").on("click",function(){
			window.location.href = "login.html";
		})
		$(".login-f1 .a2").click(function(){
			window.location.href = "login.html";
		})
		
		//登录成功后改变提示信息
		if(getCookie("a")){                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
			$(".login-f1").html("Hi! <a href='#'>"+getCookie("name")+"</a>欢迎来到速普商城!" + " [  <a href='javascript:;' class='a3' >退                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            出</a> ] 未读消息 [ <a href='javascript:;' class='a4' >1</a> ]")
		}
		//退出
		$(".a3").click(function(){
			$(".login-f1").html("欢迎来到速普商城！ 请 [<a href='javascript:;' class='a1' >登录</a> ]  [<a href='javascript:;' class='a2' >免费注册</a> ]")
			if(getCookie("123")){
				$(".reg-bn1").css({"display":"block"})
				$(".reg-bn").css({"display":"none","right":"0px"})
				$(".reg-bn1").animate({"right":"100px"},1000,function(){
					$(".reg").html("欢迎登录")
				})
				window.location.href = "login.html"
			}
		})

})

//购物车json+cookie
$(function(){
	var cookies = document.cookie
	//alert(cookies)
	var cookie = cookies.split(";")
	//alert(cookie)
	var arr = []
	for( var i = 0; i<cookie.length;i++){
		var coid= cookie[i].split("=")
		//console.log(coid)
		var nameid= coid[0]*1
		
		if(!isNaN(nameid)){
			arr.push(coid[1])
		}
	}
	$.ajax({
		url:"js/data.json",
		success:function(data){
			var mag = data.data;
			//console.log(arr)
			
			var str = ''
			var str1 = ''
			var str2 = ''
			var sum = 0;
			var n = 0;
			var n1 = 0;
			var sum1 = 0;
			for(var i = 0;i<arr.length;i++){
				for(var j = 0;j<mag.length;j++){
					if(arr[i] == mag[j].id){
						//alert(arr[i])
						//console.log(mag[i].img)
						
						 n = (getCookie("n"+mag[j].id)*78)
						 n1 = parseInt(getCookie("n"+mag[j].id))
						 sum += n 
						 sum1 += n1
						str += '<ul class="con_top4_list"><li><span class="l" style="width: 155px; padding-left: 10px;"><input type="checkbox" checked="checked" /></span><span class="l name" style="width: 450px;"><dl><dt class="l"><img src="'+mag[j].img+'" width="60px" /></dt><dd class="l"><span class="name1"><a href="detail.html" style="color: #333333;">'+ mag[j].name +'</a></span><span><ul><li>颜色：黄色</li><li>尺码：M</li></ul></span></dd></dl></span><span class="l p1 p1_1" style="width: 122px;">￥78</span><span class="l p1 p1_2" style="width: 122px;"><a class="l leftbtn" href="javascript:;">-</a><span class="l"><input type="text" value="'+getCookie("n"+mag[j].id)+'" min="1"/></span><a class="l rightbtn" href="javascript:;" style="margin-right: 20px;">+</a></span><span class="l p1 p1_3" style="width: 122px;">￥<b>'+n+'</b></span><span class="l p1 p1_4" style="width: 122px;"><ul><li class="delete" ><a href="javascript:;"style="color:#333;" dataid="'+mag[j].id+'">删除</a></li><li>收藏</li></ul></span></li></ul>'
					}  
				}
			}
			$(".con_top5 .r li span b").text(sum)
			$("#goods1").text(sum1)
			$("#goods2").text(sum1)
			$("#b1").text(sum)
			$("#b2").text(sum)
			
			$(".con_top4").append(str)
			
			$(".leftbtn").click(function(){
				var i = $(this).next().children("input").val()
				
				
				var pic =$(this).parent(".p1_2").siblings(".p1_1").text()
				var pic1 = parseInt(pic.slice(1))
				console.log(pic1)
				var goods = parseInt($(this).parent(".p1_2").children("span").children("input").val())
				console.log(goods)
				var all = pic1*goods
				
				if(i<=1){
					
				}else{
					--i
				$(this).next().children("input").val(i)
				}
				$(this).parent(".p1_2").next().children("b").text(all)
				if(goods>=2){
					--sum1
					sum -= pic1
					//alert(sum)
					$("#goods1").text(sum1)
					$("#goods2").text(sum1)
					$("#b1").text(sum)
					$("#b2").text(sum)
					$("#all").text(sum)
				}
				
			})
			
			$(".rightbtn").click(function(){
				var i = $(this).prev().children("input").val()
				//console.log(i)
				if(i<10){
					++i
					$(this).prev().children("input").val(i)
				}else{
					alert("商品储量不足！")
				}
				
				//console.log(i)
				
				var pic =$(this).parent(".p1_2").siblings(".p1_1").text()
				var pic1 = parseInt(pic.slice(1))
				//console.log(pic1)
				var goods = parseInt($(this).parent(".p1_2").children("span").children("input").val())
				//console.log(goods)
				var all = pic1*goods
				$(this).parent(".p1_2").next().children("b").text(all)
				if(goods>0){
					++sum1
					sum += pic1
					$("#goods1").text(sum1)
					$("#goods2").text(sum1)
					$("#b1").text(sum)
					$("#b2").text(sum)
					$("#all").text(sum)
				}
				
			})
			$(".delete").on("mouseover","a",function(){
				sh = parseInt($(this).parents(".p1_4").siblings(".p1_3").children("b").text())
				sl = parseInt($(this).parents(".p1_4").siblings(".p1_2").children("span").children("input").val())
				//alert(sl)	
			})
			$(".delete").on("click","a",function(){
				//alert(1)
				
				var dataid = $(this).attr("dataid")
					$("#goods1").text(sum1 - sl)
					$("#goods2").text(sum1 - sl)
					$("#b1").text(sum- sh)
					$("#b2").text(sum- sh)
					$("#all").text(sum- sh)
				$(this).parents(".con_top4_list").remove()
				
				removeCookie(dataid)
				removeCookie("n"+dataid)
				
			})
			$(".buy").on("click","a",function(){
				window.location.href = "buy.html"
			})
			$(".buy a").mouseover(function(){
				$(this).css("background","#FFB033")
			})
			$(".buy a").mouseout(function(){
				$(this).css("background","#E5004A")
			})
		
		}
	})
	
})